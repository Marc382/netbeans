<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="netbeans" name="java/java.lsp.server">
    <description>Builds, tests, and runs the project org.netbeans.modules.java.lsp.server</description>
    <import file="../../nbbuild/templates/projectized.xml"/>
    <target name="build-lsp-server" depends="-set-use-jdk-javac,build,test-init">
        <mkdir dir="${lsp.build.dir}/bin" />
        <mkdir dir="${lsp.build.dir}/lib" />
        <copy todir="${lsp.build.dir}/lib/platform" failonerror="false">
            <fileset dir="${netbeans.dest.dir}/platform" />
        </copy>
        <copy todir="${lsp.build.dir}/lib/ide" failonerror="false">
            <fileset dir="${netbeans.dest.dir}/ide" />
        </copy>
        <copy todir="${lsp.build.dir}/lib/extide" failonerror="false">
            <fileset dir="${netbeans.dest.dir}/extide" />
        </copy>
        <copy todir="${lsp.build.dir}/lib/java" failonerror="false">
            <fileset dir="${netbeans.dest.dir}/java" excludes="**/org-netbeans-modules-java-hints-test.jar" />
        </copy>
        <pathconvert refid="test.unit.run.cp" property="server.classpath">
            <flattenmapper/>
        </pathconvert>
        <copy todir="${lsp.build.dir}/bin" file="script/nb-java-lsp-server">
            <filterset>
                <filter token="CLASSPATH" value="${server.classpath}" />
            </filterset>
        </copy>
        <chmod file="${lsp.build.dir}/bin/nb-java-lsp-server" perm="u+x" />
        <delete file="${lsp.build.dir}/lib/nb-javac-9-api.jar" />
        <delete file="${lsp.build.dir}/lib/nb-javac-9-impl.jar" />
        <delete file="${lsp.build.dir}/lib/org-netbeans-modules-java-source-nbjavac.jar" />
    </target>
    <target name="build-lsp-server-classpath" depends="-set-use-jdk-javac,build,test-init">
        <pathconvert refid="test.unit.run.cp" property="server.classpath">
            <flattenmapper/>
        </pathconvert>
        <echo file="${lsp.server.classpath.target}">${server.classpath}:org-netbeans-modules-java-lsp-server.jar</echo>
    </target>
    <target name="-set-use-jdk-javac">
        <property name="test.use.jdk.javac" value="true" />
    </target>
    <target name="clean" depends="projectized.clean">
        <delete dir="${lsp.build.dir}" />
    </target>
</project>
